<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin</title>
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <script src="https://kit.fontawesome.com/97dbc65e21.js" crossorigin="anonymous"></script>

  <style>
    *{
      scroll-behavior: smooth;
      transition: all 1s;
    }

    #dashboardPage{
      display: block;
    }

    #carPage{
      display: none;
    }

    #driverPage{
      display: none;
    }

    #customerPage{
      display: none;
    }

    tr{
      cursor: pointer;
    }

    tr:hover{
      background: #ffc107;
    }
    tr:hover img{
      transform: scale(1.3);
    }

    .tablePendingBooking{
      font-size: 15px;
    }

    .bd-all-booking-modal-lg{
      width: 100%;
    }

    #returnForm{
      display: none;
    }

    .admin-modal{
      background: #313131;
      color: #ffc107;
    }


  </style>

</head>
<body>
<!--navBar-->
<nav class="navbar shadow-sm navbar-expand-lg navbar-light bg-warning">
  <div class="container">
    <a class="navbar-brand" href="#"><img src="assets/images/LogoBlack.png" width="200" alt=""></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" id="dashboardNav" href="#">Dashboard</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="carsNav" href="#">Cars</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="customersNav">Customers</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="driversNav">Drivers</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="returnNav">Return</a>
        </li>
        <li class="nav-item">
          <a class="nav-link btn btn-outline-danger" data-toggle="modal" data-target=".bd-all-booking-modal-lg" href="#">View All Bookings</a>
        </li>
      </ul>
      <button class="btn btn-outline-light navbar-text" id="adminProfile">
                <i class="fa-solid fa-user"></i>
                Administrator
            </button>
    </div>
  </div>
</nav>

<!--Admin Profile Modal-->

<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-admin-modal-lg">Large modal</button>
<div class="modal fade bd-admin-modal-lg" tabindex="-1" role="dialog" aria-labelledby="adminModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content admin-modal">

<!--      Add a admin-->
      <div class="container p-3 modal-body add-admin">
        <div class="modal-title"><h3>Add an Admin</h3></div>
        <form>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="add_adminId">Admin Id:</label>
                <input type="text" class="form-control" id="add_adminId" name="add_adminId" placeholder="Example input">
              </div>
              <div class="form-group">
                <label for="add_adminName">Name:</label>
                <input type="text" class="form-control" id="add_adminName" name="add_adminName" placeholder="Example input">
              </div>
              <div class="form-group">
                <label for="add_adminusername">Username:</label>
                <input type="text" class="form-control" id="add_adminusername" name="add_adminusername" placeholder="Example input">
              </div>
              <div class="form-group">
                <label for="add_adminpassword">Password:</label>
                <input type="password" class="form-control" id="add_adminpassword" name="add_adminpassword" placeholder="Example input">
              </div>
              <div class="form-group">
                <button class="btn btn-outline-warning" type="button" id="btnSaveAdmin">Save</button>
                <button class="btn btn-outline-warning" type="button" id="btnAllAdmins">All Admins</button>
              </div>
            </div>
            <div class="col">
              <div class="p-1 border border-warning rounded-lg"><img class="rounded-lg" src="assets/images/adminvector.jpg" width="100%"></div>
            </div>
          </div>
        </form>
      </div>

<!--      Admin Table-->
      <div class="container p-3 modal-body all-admins">
        <div class="modal-title"><h3>All Admins</h3></div>
        <div>
          <table class="table shadow tablePendingBooking">
            <thead class="thead-dark">
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Admin Name</th>
              <th scope="col">Username</th>
            </tr>
            </thead>
            <tbody id="tblAdmins">
            </tbody>
          </table>
        </div>
        <button class="btn btn-outline-warning" type="button" id="btnGetAdminForm">Add an Admins</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="warningModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="txtWarningHeader">Warning!</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="txtWarning">

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--  All Booking Table Modal-->
<div class="modal fade bd-all-booking-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <table class="table shadow tablePendingBooking bg-light">
        <thead class="thead-dark">
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Cus-NIC</th>
          <th scope="col">Cus-Name</th>
          <th scope="col">Car-No</th>
          <th scope="col">Car-Brand</th>
          <th scope="col">Model</th>
          <th scope="col">With Driver</th>
          <th scope="col">Driver-LIC</th>
          <th scope="col">Driver-Name</th>
          <th scope="col">Start Date</th>
          <th scope="col">End Date</th>
          <th scope="col">Rental</th>
          <th scope="col">Admin Status</th>
        </tr>
        </thead>
        <tbody id="tblAllBookings">
        </tbody>
      </table>
    </div>
  </div>
</div>

<!--Return Form-->
<!--<div id="returnForm">-->
<!--<div class="container">-->
<!--  <div class="mt-md-4 mb-md-4">-->
<!--    <h1>Return</h1>-->
<!--            <form id="fromReturn">-->
<!--              <div class="row">-->
<!--              <div class="form-group col-md-3">-->
<!--                <label for="fn_bkid">Booking ID:</label>-->
<!--                <select class="form-control" id="fn_bkid" name="fn_bkid">-->
<!--                  <option value="BK00-001">BK00-001</option>-->
<!--                  <option value="BK00-002">BK00-002</option>-->
<!--                  <option value="BK00-003">BK00-003</option>-->
<!--                  <option value="BK00-004">BK00-004</option>-->
<!--                </select>-->
<!--              </div>-->
<!--              <div class="form-group col-md-3">-->
<!--                <label for="fn_cus">Customer:</label>-->
<!--                <input type="text" class="form-control" id="fn_cus" name="fn_cus" disabled required>-->
<!--              </div>-->
<!--                <div class="form-group col-md-3">-->
<!--                  <label for="fn_cusnic">Customer NIC:</label>-->
<!--                  <input type="text" class="form-control" id="fn_cusnic" name="fn_cusnic" disabled required>-->
<!--                </div>-->

<!--              <div class="form-group col-md-3">-->
<!--                <label for="fn_car">Car:</label>-->
<!--                <input type="text" class="form-control" id="fn_car" name="fn_car" disabled required>-->
<!--              </div>-->
<!--              </div>-->
<!--              <div class="row">-->
<!--                <div class="form-group col-md-4">-->
<!--                  <label for="fn_driver">Driver:</label>-->
<!--                  <input type="text" class="form-control" id="fn_driver" name="fn_driver" disabled required>-->
<!--                </div>-->
<!--                <div class="form-group col-md-4">-->
<!--                  <label for="fn_drlic">Driver LIC:</label>-->
<!--                  <input type="text" class="form-control" id="fn_drlic" name="fn_drlic" disabled required>-->
<!--                </div>-->
<!--              </div>-->

<!--                <div class="dropdown-divider"></div>-->

<!--                <div class="row">-->
<!--                  <div class="form-group col-md-4">-->
<!--                    <label for="fn_rental">Rental:</label>-->
<!--                    <input type="text" class="form-control" id="fn_rental" name="fn_rental" disabled required>-->
<!--                  </div>-->
<!--                  <div class="form-group col-md-4">-->
<!--                    <label for="fn_exkm">Extra KM:</label>-->
<!--                    <input type="text" class="form-control" id="fn_exkm" name="fn_exkm" required>-->
<!--                  </div>-->
<!--                  <div class="form-group col-md-4">-->
<!--                    <label for="fn_ldw">Loss Damage Waiver:</label>-->
<!--                    <input type="text" class="form-control" id="fn_ldw" name="fn_ldw" required>-->
<!--                  </div>-->
<!--                </div>-->
<!--                <div class="row d-flex justify-content-end">-->
<!--                  <div class="form-group col-md-3">-->
<!--                    <label for="fn_subtotal">SubTotal:</label>-->
<!--                    <input type="text" class="form-control border-danger" id="fn_subtotal" name="fn_subtotal" disabled required>-->
<!--                  </div>-->
<!--                </div>-->
<!--              <button type="button" class="btn btn-success" id="btnSubmitReturn">Submit</button>-->
<!--            </form>-->
<!--          </div>-->
<!--  </div>-->
<!--</div>-->

<!--Dashboard-->
<div id="dashboardPage">
<div class="container">
<div class="mt-md-4 mb-md-4">
  <h1>Dashboard</h1>
<div class="row">
  <div class="col-md-3">
    <div class="card shadow text-dark bg-warning mb-3">
      <div class="card-body">
        <h5 class="card-title">Cars</h5>
        <h1 class="display-4"><strong id="txtCountCar">30</strong></h1>
        <i class="fa-solid fa-car  display-4 d-flex justify-content-end"></i>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow text-dark bg-warning mb-3">
      <div class="card-body">
        <h5 class="card-title">Customers</h5>
        <h1 class="display-4" ><strong id="txtCountCus">18</strong></h1>
        <i class="fa-solid fa-user  display-4 d-flex justify-content-end"></i>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow text-dark bg-warning mb-3">
      <div class="card-body">
        <h5 class="card-title">Drivers</h5>
        <h1 class="display-4" ><strong id="txtCountDr">15</strong></h1>
        <i class="fa-solid fa-person  display-4 d-flex justify-content-end"></i>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow text-dark bg-warning mb-3">
      <div class="card-body">
        <h5 class="card-title">Bookings</h5>
        <h1 class="display-4" ><strong id="txtCountBk">03</strong></h1>
        <i class="fa-solid fa-plus  display-4 d-flex justify-content-end"></i>
      </div>
    </div>
  </div>
</div>
  </div>


<!--  booking table-->
  <div>
    <table class="table shadow tablePendingBooking">
      <thead class="thead-dark">
      <tr>
        <th scope="col">ID</th>
        <th scope="col">Cus-NIC</th>
        <th scope="col">Cus-Name</th>
        <th scope="col">Car-No</th>
        <th scope="col">Car-Brand</th>
        <th scope="col">Model</th>
        <th scope="col">With Driver</th>
        <th scope="col">Driver-LIC</th>
        <th scope="col">Driver-Name</th>
        <th scope="col">Start Date</th>
        <th scope="col">End Date</th>
        <th scope="col">Rental</th>
        <th scope="col">Option</th>
      </tr>
      </thead>
      <tbody id="tblPendingBooking">
      </tbody>
    </table>
  </div>
</div>
</div>

<!--Car Management-->
<div id="carPage">
<div class="container">
<div class="mt-md-4 mb-md-4">
  <h1>Cars</h1>
  <div class="row">
    <div class="col">
      <form id="formCar">
        <div class="row mt-4">
          <div class="col">
            <label for="cr_reg">Reg Number</label>
            <input type="text" class="form-control" id="cr_reg" name="cr_reg" placeholder="ABC-1234">
          </div>
          <div class="col">
            <label for="cr_make">Make</label>
            <input type="text" class="form-control" id="cr_make" name="cr_make" placeholder="Toyota, Suzuki, Honda">
          </div>
          <div class="col">
            <label for="cr_model">Model</label>
            <input type="text" class="form-control" id="cr_model" name="cr_model" placeholder="Vitz, Lancer">
          </div>
        </div>
        <div class="row mt-4">
          <div class="col">
            <label for="cr_fuel">Fuel Type</label>
            <select class="form-control" id="cr_fuel" name="cr_fuel">
              <option value="Petrol">Petrol</option>
              <option value="Diesel">Diesel</option>
              <option value="Hybrid">Hybrid</option>
              <option value="Electric">Electric</option>
            </select>
          </div>
          <div class="col">
            <label for="cr_type">Category</label>
            <select class="form-control" id="cr_type" name="cr_type">
              <option value="General">General</option>
              <option value="Premium">Premium</option>
              <option value="Luxury">Luxury</option>
            </select>
          </div>
          <div class="col">
            <label for="cr_nfp">No of Passengers</label>
            <select class="form-control" id="cr_nfp" name="cr_nfp">
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4" selected>4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
            </select>
          </div>
        </div>
        <div class="form-group row mt-4">
          <div class="col">
            <label for="cr_day">Price per Day</label>
            <input type="text" class="form-control" id="cr_day" name="cr_day" placeholder="Rs:">
          </div>
          <div class="col">
            <label for="cr_month">Month</label>
            <input type="text" class="form-control" id="cr_month" name="cr_month" placeholder="Rs:">
          </div>
          <div class="col">
            <label for="cr_km">Extra Km</label>
            <input type="text" class="form-control" id="cr_km" name="cr_km" placeholder="Rs:">
          </div>
        </div>
        <div class="form-group row mt-4">
          <div class="col">
            <label for="txtCar_rangeDay">Range per Day</label>
            <input type="text" class="form-control" id="txtCar_rangeDay" placeholder="Km:">
          </div>
          <div class="col">
            <label for="cr_rangeMonth">Range per Month</label>
            <input type="text" class="form-control" id="cr_rangeMonth" placeholder="Km:">
          </div>
          <div class="col">
            <label for="cr_avail">Availability</label>
            <select class="form-control" id="cr_avail" name="cr_avail">
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>
        </div>
        <div class="form-group row mt-4">
          <div class="col">
            <label for="cr_img">Car Image</label>
            <input type="file" class="form-control-file" id="cr_img" name="cr_img">
          </div>
          <div class="col-3">
            <button class="btn btn-success" type="button" id="btnSaveCar">Save</button>
            <button class="btn btn-warning" type="button" id="btnUpdateCar">Update</button>
            <button class="btn btn-danger" type="button" id="btnDeleteCar">Delete</button>
          </div>
        </div>
      </form>

    </div>
  </div>


  <div class="row">

    <!--  Car table-->
    <div class="col">
      <table class="table shadow">
        <thead class="thead-dark">
        <tr>
          <th scope="col">RegNo</th>
          <th scope="col">Make</th>
          <th scope="col">Model</th>
          <th scope="col">Type</th>
          <th scope="col">Fuel</th>
          <th scope="col">NoPas</th>
          <th scope="col">Day/Rs</th>
          <th scope="col">Month/Rs</th>
          <th scope="col">Km/Rs</th>
          <th scope="col">Avail</th>
          <th scope="col">Image</th>
        </tr>
        </thead>
        <tbody id="tblCar">
        </tbody>
      </table>
    </div>
  </div>
</div>
</div>
</div>

<!--Customer Management-->
<div id="customerPage">
  <div class="container">
    <div class="mt-md-4 mb-md-4">
      <h1>Customers</h1>
      <div class="row ">
<!--        <div class="col-5">-->
<!--          <form id="fromCustomer">-->
<!--            <div class="form-group">-->
<!--              <label for="cus_nic">NIC Number:</label>-->
<!--              <input type="text" class="form-control" id="cus_nic" name="cus_nic" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--              <label for="cus_name">Name:</label>-->
<!--              <input type="text" class="form-control" id="cus_name" name="cus_name" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--              <label for="cus_address">Address:</label>-->
<!--              <input type="text" class="form-control" id="cus_address" name="cus_address" required>-->
<!--            </div>-->
<!--            <div class="row">-->
<!--              <div class="col form-group">-->
<!--                <label for="cus_contact">Contact Number:</label>-->
<!--                <input type="text" class="form-control" id="cus_contact" name="cus_contact" required>-->
<!--              </div>-->
<!--              <div class="col form-group">-->
<!--              <label for="cus_email">Email:</label>-->
<!--              <input type="email" class="form-control" id="cus_email" name="cus_email" required>-->
<!--            </div></div>-->

<!--            <div class=" form-group">-->
<!--              <label for="cus_img">NIC Image:</label>-->
<!--              <input type="file" class="form-control-file" id="cus_img" accept="image/*" required>-->
<!--            </div>-->
<!--            <button type="button" class="btn btn-success" id="btnSaveCus">Save</button>-->
<!--            <button type="button" class="btn btn-warning" id="btnUpdateCus">Update</button>-->
<!--            <button type="button" class="btn btn-danger btnDeleteCus" >Remove</button>-->
<!--          </form>-->
<!--        </div>-->





        <!--  Customer table-->
        <div class="col">
          <table class="table shadow">
            <thead class="thead-dark">
            <tr>
              <th scope="col">NIC-No</th>
              <th scope="col">Name</th>
              <th scope="col">Address</th>
              <th scope="col">Contact</th>
              <th scope="col">Email</th>
              <th scope="col">NIC-Image</th>
              <th scope="col">Option</th>
            </tr>
            </thead>
            <tbody id="tblCustomer">

            </tbody>
          </table>
        </div>
      </div>
      <div class="row">
        <div id="display">

        </div>
      </div>
    </div>
  </div>
</div>

<!--Driver Management-->
<div id="driverPage">
  <div class="container">
    <div class="mt-md-4 mb-md-4">
      <h1>Drivers</h1>
      <div class="row ">
        <div class="col-4">
          <form id="formDriver">
            <div class="row mt-4">
              <div class="col">
                <label for="dr_lic">License Number</label>
                <input type="text" class="form-control" id="dr_lic" name="dr_lic" placeholder="B12345678">
              </div>
              <div class="col">
                <label for="dr_name">Name</label>
                <input type="text" class="form-control" id="dr_name" name="dr_name" placeholder="Pasan Kumara">
              </div>
            </div>
            <div class="row mt-4">
              <div class="col">
                <label for="dr_contact">Contact Number</label>
                <input type="tel" class="form-control" id="dr_contact" name="dr_contact" placeholder="0712345678">
              </div>
              <div class="col">
                <label for="dr_avail">Availability</label>
                <select class="form-control" id="dr_avail" name="dr_avail">
                <option value="Yes" selected>Yes</option>
                <option value="No">No</option>
              </select>
              </div>
            </div>
            <div class="form-group row mt-4">
              <div class="col">
                <button class="btn btn-success" type="button" id="btnSaveDr" data-toggle="modal" data-target=".bd-example-modal-sm">Save</button>
                <button class="btn btn-warning" type="button" id="btnUpdateDr" >Update</button>
                <button class="btn btn-danger" type="button" id="btnDeleteDr" >Delete</button>
              </div>
            </div>
          </form>

        </div>



        <!--  Driver table-->
        <div class="col-8">
          <table class="table shadow">
            <thead class="thead-dark">
            <tr>
              <th scope="col">License Number</th>
              <th scope="col">Name</th>
              <th scope="col">Contact</th>
              <th scope="col">Availability</th>
            </tr>
            </thead>
            <tbody id="tblDriver">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!--Modal For Login Details-->
<div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content bg-dark rounded-lg">
      <div class="login-form p-lg-4 border border-warning rounded-lg">
        <form id="formCusLogin">
          <p class="text-center text-warning"><Strong>Saved!</Strong><br>Now Enter Login Details</p>
          <h2 class="text-center">SignUp</h2>
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" class="form-control" id="username" name="username" aria-describedby="emailHelp" placeholder="Username">
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" class="form-control" id="password" placeholder="Password">
          </div>
          <button type="button" class="btn btn-warning font-weight-bold" id="btnSaveDrWithLogin" >Save</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="assets/js/jquery-3.6.1.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>

<script>

  let baseURL = "http://localhost:8080/BackEnd_war/"
  let projectPath = "C:\\Users\\ASUS\\Documents\\GDSE60\\Advanced API\\AAD CourseWork\\Easy_car_rental_private_limited\\BackEnd\\src\\main\\resources\\static\\Images";

  getCusCount();
  getDrCount()
  getCarCount();
  getBookingCount();


  getAllCustomers();
  getAllDrivers();
  getAllCars();
  getAllBooking();

  cusBindRowClickEvents();
  carBindRowClickEvents();
  drBindRowClickEvents();

  function txtCountCards(cars, customers, drivers, bookings){
    $("#txtCountCar").text(cars);
    $("#txtCountCus").text(customers);
    $("#txtCountDr").text(drivers);
    $("#txtCountBk").text(bookings);
  }

  $("#dashboardNav").click(function (){
    $("#dashboardPage").css("display" , "block");
    $("#carPage").css("display", "none");
    $("#customerPage").css("display", "none");
    $("#driverPage").css("display", "none");
  });

  $("#carsNav").click(function (){
    $("#dashboardPage").css("display" , "none");
    $("#carPage").css("display", "block");
    $("#customerPage").css("display", "none");
    $("#driverPage").css("display", "none");
  });

  $("#customersNav").click(function (){
    $("#dashboardPage").css("display" , "none");
    $("#carPage").css("display", "none");
    $("#customerPage").css("display", "block");
    $("#driverPage").css("display", "none");
  });

  $("#driversNav").click(function (){
    $("#dashboardPage").css("display" , "none");
    $("#carPage").css("display", "none");
    $("#customerPage").css("display", "none");
    $("#driverPage").css("display", "block");
  });

  function setCusTxtField(cus_nic, cus_name, cus_address, cus_contact, cus_email){
    $("#cus_nic").val(cus_nic);
    $("#cus_name").val(cus_name);
    $("#cus_address").val(cus_address);
    $("#cus_contact").val(cus_contact);
    $("#cus_email").val(cus_email);
  }

  function setDrTextField(dr_lic, dr_name, dr_contact, dr_avail){
    $("#dr_lic").val(dr_lic);
    $("#dr_name").val(dr_name);
    $("#dr_contact").val(dr_contact);
    $("#dr_avail").val(dr_avail);
  }

  function cusBindRowClickEvents(){
      $("#tblCustomer>tr").click(function () {
        let cusNic = $(this).children(":eq(0)").text();
        let cusName = $(this).children(":eq(1)").text();
        let cusAddress = $(this).children(":eq(2)").text();
        let cusContact = $(this).children(":eq(3)").text();
        let cusEmail = $(this).children(":eq(4)").text();

        $('#cus_nic').val(cusNic);
        $('#cus_name').val(cusName);
        $('#cus_address').val(cusAddress);
        $('#cus_contact').val(cusContact);
        $('#cus_email').val(cusEmail);
      });
    }

  function carBindRowClickEvents() {
    $("#tblCar>tr").click(function () {
      let carReg = $(this).find("td:eq(0)").text();
      let carMake = $(this).find("td:eq(1)").text();
      let carModel = $(this).find("td:eq(2)").text();
      let carType = $(this).find("td:eq(3)").text();
      let carFuel = $(this).find("td:eq(4)").text();
      let carPas = $(this).find("td:eq(5)").text();
      let carDay = $(this).find("td:eq(6)").text();
      let carMonth = $(this).find("td:eq(7)").text();
      let carKm = $(this).find("td:eq(8)").text();
      let carAvail = $(this).find("td:eq(9)").text();

      $('#cr_reg').val(carReg);
      $('#cr_make').val(carMake);
      $('#cr_model').val(carModel);
      $('#cr_type').val(carType);
      $('#cr_fuel').val(carFuel);
      $('#cr_day').val(carDay);
      $('#cr_month').val(carMonth);
      $('#cr_km').val(carKm);
      $('#cr_nfp').val(carPas);
      $('#cr_avail').val(carAvail);

      console.log(carType);
    });
  }

  function drBindRowClickEvents() {
    $("#tblDriver>tr").click(function () {
      let drLic = $(this).find("td:eq(0)").text();
      let drName = $(this).find("td:eq(1)").text();
      let drContact = $(this).find("td:eq(2)").text();
      let drAvail = $(this).find("td:eq(3)").text();


      $('#dr_lic').val(drLic);
      $('#dr_name').val(drName);
      $('#dr_contact').val(drContact);
      $('#dr_avail').val(drAvail);

    });
  }

  // Driver - Done

  let tempDriverUserName;
  let tempDriverName;
  let tempDriverLic;

    $("#btnSaveDrWithLogin").click(function () {
      let driverFormData = $("#formDriver").serialize();

      tempDriverLic = $("#dr_lic").val();
      tempDriverName = $("#dr_name").val();

      // let driverDataObj={
      //   dr_lic: $("#dr_lic").val(),
      //   dr_name: $("#dr_name").val(),
      //   dr_contact: $("#dr_contact").val(),
      //   dr_avail: $("#dr_avail").val()
      // }

      $.ajax({
        url: baseURL + "driver/save",
        method: "post",
        data: driverFormData,
        dataType: "json",
        success: function (res) {

          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(res.message);
          getAllDrivers();
          getDrCount()
        },
        error: function (err) {
          let message = JSON.parse(err.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);
        }
      });

      let driverLoginObj = {
        userId: $("#dr_lic").val(),
        userName: $("#username").val(),
        password: $("#password").val(),
        role: "Driver"
      }

      tempDriverUserName = $("#username").val();

      $.ajax({
        url: baseURL + "register/driver",
        method: "post",
        data: driverLoginObj,
        dataType: "json",
        success: function (res) {
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(res.message);
        },
        error: function (err){
          let message = JSON.parse(err.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);
        }
      });
    });


    $("#btnUpdateDr").click(function () {

      let driverDataObj={
        dr_lic: $("#dr_lic").val(),
        dr_name: $("#dr_name").val(),
        dr_contact: $("#dr_contact").val(),
        dr_avail: $("#dr_avail").val()
      }

      $.ajax({
        url: baseURL + "driver/update",
        method: "PUT",
        data: JSON.stringify(driverDataObj),
        contentType: "application/json",
        dataType: "json",
        success: function (res) {
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(res.message);
          getAllDrivers();
        },
        error: function (err) {
          let message = JSON.parse(err.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);
        }
      });
    });

    $("#btnDeleteDr").click(function () {
      let dr_lic = $("#dr_lic").val();
      $.ajax({
        url: baseURL + "driver/delete?dr_lic=" + dr_lic,
        method: "delete",
        success: function (res) {
          $.ajax({
            url: baseURL + "register/getuser?userId="+dr_lic,
            method: "get",
            success: function (resp) {
              console.log("Found : "+resp.data.userName);
              deleteDriverLogin(resp.data.userName);

            }
          });
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(res.message);
          getAllDrivers();
          getDrCount()
        },
        error: function (err) {
          let message = JSON.parse(err.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);
        }
      });
    });

  function deleteDriverLogin(userName){
    $.ajax({//Not working because we need userName. not cus_nic for delete this login info from user table
      url: baseURL + "register/deletedriver?userName=" + userName,
      method: "delete",
      success: function (resp) {
        console.log("Customer Login info deleted");
      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        console.log(message)
      }
    });
  }

  function getAllDrivers() {
    $("#tblDriver").empty();
    $.ajax({
      url: baseURL + "driver/alldr",
      method: 'get',
      dataType: 'json',
      success: function (res) {
        for (let c of res.data) {
          let dr_lic = c.dr_lic;
          let dr_name = c.dr_name;
          let dr_contact = c.dr_contact;
          let dr_avail = c.dr_avail;

          let row = "<tr><td>" + dr_lic + "</td><td>" + dr_name + "</td><td>" + dr_contact + "</td><td>" + dr_avail + "</td></tr>";

          $("#tblDriver").append(row);
          drBindRowClickEvents();
          setDrTextField("", "", "", "", "");
        }

      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        alert(message);
        cusBindRowClickEvents();
        setCusTxtField("", "", "", "", "");
      }
    });
  }

  function getDrCount() {
    $.ajax({
      url: baseURL + "driver/count",
      method: 'get',
      dataType: 'json',
      success: function (res) {
        if (res.data < 10) {
          $("#txtCountDr").text("0" + res.data);
        } else {
          $("#txtCountDr").text(res.data);
        }

      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        alert(message);
        cusBindRowClickEvents();
        setCusTxtField("", "", "", "", "");
      }
    });
  }


  //Customer - Done

  let tempUserName;

    $("#btnSaveCus").click(function () {
      let formCusData = $("#fromCustomer").serialize();

      // let file = $("#cus_img")[0].files[0];

      $.ajax({
        url: baseURL + "customer/save",
        method: "post",
        data: formCusData,
        dataType: "json",
        success: function (res) {
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(res.message);

          console.log("Success : " + res.message);
          getAllCustomers();
          setCusTxtField("", "", "", "", "");
          getCusCount();
        },
        error: function (err) {
          let message = JSON.parse(err.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);
          console.log("Error : " + message)
        }
      });
    });

    $("#btnUpdateCus").click(function () {
      let cusDataObj = {
        cus_nic: $("#cus_nic").val(),
        cus_name: $("#cus_name").val(),
        cus_address: $("#cus_address").val(),
        cus_contact: $("#cus_contact").val(),
        cus_email: $("#cus_email").val()
      };

      $.ajax({
        url: baseURL + "customer/update",
        method: "PUT",
        data: JSON.stringify(cusDataObj),
        contentType: "application/json",
        dataType: "json",
        success: function (res) {
          let message = res.message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(res.message);

          console.log("Success : " + message);
          setCusTxtField("", "", "", "", "")
          getAllCustomers();
          getCusCount();
        },
        error: function (err) {
          let message = JSON.parse(err.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);

          console.log("Error : " + message)
        }
      });
    });

    $(".btnDeleteCus").click(function () {
      let cus_nic = $("#cus_nic").val();

      $.ajax({
        url: baseURL + "customer/delete?cus_nic=" + cus_nic,
        method: "delete",
        success: function (resp) {

          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(resp.message);


          getAllCustomers();
          setCusTxtField("", "", "", "", "")
          getCusCount();
        },
        error: function (error) {
          let message = JSON.parse(error.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);
        }
      });
    });

    $(document).on('click', '.btnDeleteCus', function () {
    let cus_nic = $(this).closest('tr').find('td:first').text();
    $.ajax({
      url: baseURL + "customer/delete?cus_nic=" + cus_nic,
      method: "delete",
      success: function (resp) {

        $.ajax({
          url: baseURL + "register/getuser?userId="+cus_nic,
          method: "get",
          success: function (resp) {
            console.log("Found : "+resp.data.userName);
            deleteCustomerLogin(resp.data.userName);

          }
        });



        $("#warningModal").modal();
        $("#txtWarningHeader").text("Success");
        $("#txtWarning").text(resp.message);

        getAllCustomers();
        setCusTxtField("", "", "", "", "")
        getCusCount();
      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        $("#warningModal").modal();
        $("#txtWarningHeader").text("Error");
        $("#txtWarning").text(message);
      }
    });
  });

    function deleteCustomerLogin(userName){
      $.ajax({//Not working because we need userName. not cus_nic for delete this login info from user table
        url: baseURL + "register/deletecustomer?userName=" + userName,
        method: "delete",
        success: function (resp) {
          console.log("Customer Login info deleted");
        },
        error: function (error) {
          let message = JSON.parse(error.responseText).message;
          console.log(message)
        }
      });
    }

    function getAllCustomers() {
      $("#tblCustomer").empty();
      $.ajax({
        url: baseURL + "customer/allcus",
        method: 'get',
        dataType: 'json',
        success: function (res) {
          for (let c of res.data) {
            let cusNic = c.cus_nic;
            let cusName = c.cus_name;
            let cusAddress = c.cus_address;
            let cusContact = c.cus_contact;
            let cusEmail = c.cus_email;

            $.ajax({
              url: baseURL + "image/findimage?imageId="+c.cus_nic,
              method: 'get',
              dataType: 'json',
              success: function (res){
                let row = "<tr><td>" + cusNic + "</td><td>" + cusName + "</td><td>" + cusAddress + "</td><td>" + cusContact + "</td><td>" + cusEmail + "</td><td><img src="+baseURL+res.data.imageUrl+" width='100'></td><td><button type='button' class='btn btn-sm btn-danger btnDeleteCus'>Remove</button></td></tr>";

                $("#tblCustomer").append(row);

                cusBindRowClickEvents();
              },
              error: function (err){
                console.log("Can't Load Image : "+JSON.parse(err.responseText).message);
              }
            });
            setCusTxtField("", "", "", "", "");
          }

        },
        error: function (error) {
          let message = JSON.parse(error.responseText).message;
          alert(message);
          cusBindRowClickEvents();
          setCusTxtField("", "", "", "", "");
        }
      });
    }

    function getCusCount() {
      $.ajax({
        url: baseURL + "customer/count",
        method: 'get',
        dataType: 'json',
        success: function (res) {
          if (res.data < 10) {
            $("#txtCountCus").text("0" + res.data);
          } else {
            $("#txtCountCus").text(res.data);
          }

        },
        error: function (error) {
          let message = JSON.parse(error.responseText).message;
          alert(message);
          cusBindRowClickEvents();
          setCusTxtField("", "", "", "", "");
        }
      });
    }


  //Car
    $("#btnSaveCar").click(function () {
      var formCarData = $("#formCar").serialize();

      $.ajax({
        url: baseURL + "car/save",
        method: "post",
        data: formCarData,
        dataType: "json",
        success: function (res) {

          let carImgFormData = new FormData();

          let file1 = $("#cr_img")[0].files[0];
          let fileName1 = $("#cr_img")[0].files[0].name;

          carImgFormData.append("imageId", $("#cr_reg").val());
          carImgFormData.append("imageType", "car");
          carImgFormData.append("imageFile" ,file1, fileName1);

          $.ajax({
            url: baseURL + "image/save",
            method: "post",
            data: carImgFormData,
            dataType: "json",
            async: true,
            contentType: false,
            processData: false,
            enctype: "multipart/form-data",
            success: function (res) {
              console.log(res.message);
              getAllCars();
              getCarCount();
            },
            error: function (err){
              console.log("Can't Save Image : "+JSON.parse(err.responseText).message);
            }
          });

          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(res.message);
        },
        error: function (err) {
          let message = JSON.parse(err.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);
        }
      });
    });

    $("#btnUpdateCar").click(function () {

      var carDataObj = {
        cr_reg: $("#cr_reg").val(),
        cr_make: $("#cr_make").val(),
        cr_model: $("#cr_model").val(),
        cr_fuel: $("#cr_fuel").val(),
        cr_type: $("#cr_type").val(),
        cr_nfp: $("#cr_nfp").val(),
        cr_day: $("#cr_day").val(),
        cr_month: $("#cr_month").val(),
        cr_km: $("#cr_km").val(),
        cr_avail: $("#cr_avail").val()
      };

      $.ajax({
        url: baseURL + "car/update",
        method: "PUT",
        data: JSON.stringify(carDataObj),
        contentType: "application/json",
        dataType: "json",
        success: function (res) {
          getAllCars();
          getCarCount();
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(res.message);
        },
        error: function (err) {
          let message = JSON.parse(err.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);
        }
      });
    });

    $("#btnDeleteCar").click(function () {
      let cr_reg = $("#cr_reg").val();
      $.ajax({
        url: baseURL + "car/delete?cr_reg=" + cr_reg,
        method: "delete",
        success: function (resp) {

          $.ajax({
            url: baseURL + "image/delete?imageId=" + cr_reg,
            method: "delete",
            success:function (res){
              console.log(res.message);
            },
            error: function (err){
              let message = JSON.parse(err.responseText).message;
              console.log(err);
            }
          });

          getAllCars();
          getCarCount();
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Success");
          $("#txtWarning").text(resp.message);

        },
        error: function (error) {
          let message = JSON.parse(error.responseText).message;
          $("#warningModal").modal();
          $("#txtWarningHeader").text("Error");
          $("#txtWarning").text(message);
        }
      });
    });

  function getAllCars() {
    $("#tblCar").empty();
    $.ajax({
      url: baseURL + "car/allcar",
      method: 'get',
      success: function (res) {
        for (let c of res.data) {
          let carReg = c.cr_reg;
          let carMake = c.cr_make;
          let carModel = c.cr_model;
          let carType = c.cr_type;
          let carFuel = c.cr_fuel;
          let carNfp = c.cr_nfp;
          let carDay = c.cr_day;
          let carMonth = c.cr_month;
          let carKm = c.cr_km;
          let carAvail = c.cr_avail;

          $.ajax({
            url: baseURL + "image/findimage?imageId="+c.cr_reg,
            method: 'get',
            dataType: 'json',
            success: function (res){
              let row = "<tr><td>" + carReg + "</td><td>" + carMake + "</td><td>" + carModel + "</td><td>" + carType + "</td><td>" + carFuel + "</td><td>" + carNfp + "</td><td>" + carDay + "</td><td>" + carMonth + "</td><td>" + carKm + "</td><td>" + carAvail + "</td><td><img src="+baseURL+res.data.imageUrl+" width='100'></td></tr>";
              $("#tblCar").append(row);
              carBindRowClickEvents();
            },
            error: function (err){
              console.log("Can't Load Image : "+JSON.parse(err.responseText).message);
            }
        });
          setCarTextField("", "", "", "", "","", "", "", "", "","","");
        }

      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        alert(message);
      }
    });
  }

  function getCarCount() {
    $.ajax({
      url: baseURL + "car/count",
      method: 'get',
      dataType: 'json',
      success: function (res) {
        if (res.data < 10) {
          $("#txtCountCar").text("0" + res.data);
        } else {
          $("#txtCountCar").text(res.data);
        }

      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        alert(message);
      }
    });
  }

  function setCarTextField(cr_reg,cr_make,cr_model,cr_type,cr_fuel,cr_nfp,cr_day,cr_month,cr_km,cr_avail){
    $("#cr_reg").val(cr_reg);
    $("#cr_make").val(cr_make);
    $("#cr_model").val(cr_model);
    $("#cr_type").val(cr_type);
    $("#cr_fuel").val(cr_fuel);
    $("#cr_nfp").val(cr_nfp);
    $("#cr_day").val(cr_day);
    $("#cr_month").val(cr_month);
    $("#cr_km").val(cr_km);
    $("#cr_avail").val(cr_avail);

  }

  // Booking
  function getBookingCount() {
    $.ajax({
      url: baseURL + "booking/count",
      method: 'get',
      dataType: 'json',
      success: function (res) {
        if (res.data < 10) {
          $("#txtCountBk").text("0" + res.data);
        } else {
          $("#txtCountBk").text(res.data);
        }

      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        alert(message);
      }
    });
  }

  function getAllBooking(){
    $("#tblPendingBooking").empty();
    $("#tblAllBookings").empty();
    $("#fn_bkid").empty();
    $.ajax({
      url: baseURL + "booking/getall",
      method: 'get',
      dataType: 'json',
      success: function (res) {
        for (let c of res.data) {
          let bkId = c.bk_id;
          let bkCusnic = c.bk_cusnic;
          let bkCusname = c.bk_cusname;
          let bkCarreg = c.bk_carreg;
          let bkCarmake = c.bk_carmake;
          let bkModel = c.bk_model;
          let bkWithdriver = c.bk_withdriver;
          let bkDrlic = c.bk_drlic;
          let bkDrname = c.bk_drname;
          let bkDate = c.bk_date;
          let bkNdate = c.bk_ndate;
          let bkTotal = c.bk_total;
          let bkAdminstatus = c.bk_adminstatus;

          if (bkAdminstatus == "Approved" && bkWithdriver=="With Driver" && !bkDrname=="Pending"){
            $("#fn_bkid").append(c.bk_id);
          }

          if (bkAdminstatus == "Pending"){
            let rowPending = "<tr><td>" + bkId + "</td><td>" + bkCusnic + "</td><td>" + bkCusname + "</td><td>" + bkCarreg + "</td><td>" + bkCarmake + "</td><td>" + bkModel + "</td><td>" + bkWithdriver + "</td><td>" + bkDrlic + "</td><td>" + bkDrname + "</td><td>" + bkDate + "</td><td>" + bkNdate + "</td><td>" + bkTotal + "</td><td><button class='btn-sm btn-danger btnReject mr-1'>Reject</button><button class='btn-sm btn-success btnApprove'>Approve</button></td></tr>";
            $("#tblPendingBooking").append(rowPending);
          }

          let rowAll = "<tr><td>" + bkId + "</td><td>" + bkCusnic + "</td><td>" + bkCusname + "</td><td>" + bkCarreg + "</td><td>" + bkCarmake + "</td><td>" + bkModel + "</td><td>" + bkWithdriver + "</td><td>" + bkDrlic + "</td><td>" + bkDrname + "</td><td>" + bkDate + "</td><td>" + bkNdate + "</td><td>" + bkTotal + "</td><td>"+bkAdminstatus+"</td></tr>";
          $("#tblAllBookings").append(rowAll);

        }

      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        alert(message);
      }
    });
  }

  $(document).on('click', '.btnApprove', function () {
    let bk_id = $(this).closest('tr').find('td:first').text();
    console.log(bk_id)
    $.ajax({
      url: baseURL + "booking/findbooking?bk_id="+bk_id,
      method: "get",
      success: function (resp) {

        aprovedBookingObj = {
          bk_id: resp.data.bk_id,
          bk_cusnic: resp.data.bk_cusnic,
          bk_cusname: resp.data.bk_cusname,
          bk_carreg: resp.data.bk_carreg,
          bk_carmake: resp.data.bk_carmake,
          bk_model: resp.data.bk_model,
          bk_withdriver: resp.data.bk_withdriver,
          bk_drlic: resp.data.bk_drlic,
          bk_drname: resp.data.bk_drname,
          bk_date: resp.data.bk_date,
          bk_ndate: resp.data.bk_ndate,
          bk_total: resp.data.bk_total,
          bk_adminstatus: "Approved"
        }


        $.ajax({
          url: baseURL + "booking/update",
          method: "PUT",
          data: JSON.stringify(aprovedBookingObj),
          contentType: "application/json",
          dataType: "json",
          success: function (respond) {
            console.log(respond.message);
            getAllBooking();
            $("#warningModal").modal();
            $("#txtWarningHeader").text("Success");
            $("#txtWarning").text(respond.message);
          }
        });

        $.ajax({
          url: baseURL+"car/getcar?cr_reg="+resp.data.bk_carreg,
          method: 'get',
          success: function (res){

            var carDataObj = {
              cr_reg: res.data.cr_reg,
              cr_make: res.data.cr_make,
              cr_model: res.data.cr_model,
              cr_fuel: res.data.cr_fuel,
              cr_type: res.data.cr_type,
              cr_nfp: res.data.cr_nfp,
              cr_day: res.data.cr_day,
              cr_month: res.data.cr_month,
              cr_km: res.data.cr_km,
              cr_avail: "No"
            };

            $.ajax({
              url: baseURL + "car/update",
              method: "PUT",
              data: JSON.stringify(carDataObj),
              contentType: "application/json",
              dataType: "json",
              success: function (re) {
                getAllCars();
                getCarCount();

              },
              error: function (er) {
                let message = JSON.parse(er.responseText).message;
                console.log(message)
              }
            });
            getAllCars();
          }
        });

      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        $("#warningModal").modal();
        $("#txtWarningHeader").text("Error");
        $("#txtWarning").text(message);
      }
    });
  });

  $(document).on('click', '.btnReject', function () {
    let bk_id = $(this).closest('tr').find('td:first').text();

    $.ajax({
      url: baseURL + "booking/delete?bk_id=" + bk_id,
      method: 'delete',
      success: function (resp) {
        getAllBooking();
        $("#warningModal").modal();
        $("#txtWarningHeader").text("Success");
        $("#txtWarning").text(resp.message);
      },
      error: function (error) {
        let message = JSON.parse(error.responseText).message;
        $("#warningModal").modal();
        $("#txtWarningHeader").text("Error");
        $("#txtWarning").text(message);
      }
    });
  });

  $(document).on('click', '#adminProfile', function () {

  });





</script>
</body>
</html>