<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Easy Car Rental Service</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/97dbc65e21.js" crossorigin="anonymous"></script>

    <style>

        *{
            scroll-behavior: smooth;
            transition: all 1s;
        }
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap');
        body{
            background: #4b4b4b;
            font-family: 'Roboto', sans-serif;
        }
        .card{
            width: 250px;
            border-radius: 10px;
        }

        .card-img-top{
            border-top-right-radius: 10px;
            border-top-left-radius: 10px;
        }
        span.text-muted{
            font-size: 12px;
        }
        small.text-muted{
            font-size: 8px;
        }
        h5.mb-0{
            font-size: 1rem;
        }
        small.ghj{
            font-size: 9px;
        }
        h6.ml-1{
            font-size: 13px;
        }
        small.key{
            text-decoration: underline;
            font-size: 9px;
            cursor: pointer;
        }
        .btn-danger{
            color: #FFCBD2;
        }
        .btn-danger:focus{
            box-shadow: none;
        }
        small.justify-content-center{
            font-size: 9px;
            cursor: pointer;
            text-decoration: underline;
        }

        @media screen and (max-width:600px){
            .col-sm-4{
                margin-bottom: 50px;
            }
        }

        #welcomeScreen{
            width: 100%;
        }

        .jumbotron{
            background-image: url("assets/images/bg.jpg");
            background-size: cover;
            color: white;
        }

        .login-form{
            background: rgba(0, 0, 0, 0.62);
            border-radius: 15px;
        }

        .login-box{
            /*display: none;*/
        }

        .profile-box{
            display: none;
        }

        .settings-content{
            background-image: url("assets/images/bg.jpg");
            background-size: cover;
            color: white;
        }

        .booking-content{
            background-image: url("assets/images/bg.jpg");
            background-size: cover;
            color: white;
        }


        .car-cards{
            display: grid;
            grid-template-columns: repeat(4, 1fr);

            grid-auto-rows: auto;

            grid-gap: 1rem;
        }

        #btnProfile{
            display: none;
        }

        #driverDashboardContext{
            height: 85vh;
            background-image: url("assets/images/bg.jpg");
            background-size: cover;
            color: white;
            display: none;
        }

        .btnRent{
            display: none;
        }

        .card{
            transition: all 1s;
            cursor: pointer;
        }

        .card:hover {
            transform: scale(1.01);
            border: 2px solid #ffc107;
            box-shadow: 5px 5px 15px 0 black;
            z-index: 10;
        }

        /*.card:hover .card-img-top{*/
        /*    transform: rotate(-5deg) scale(1.03);*/
        /*    margin-bottom: 4px;*/
        /*    box-shadow: 1px 1px 20px 0 black;*/
        /*    border: 1px solid #ffc107;*/
        /*}*/

        .booking-car-img:hover img{
            transform: scale(1.5);
            z-index: 10;
        }

        .booking-car-img{
            cursor: zoom-in;
        }



    </style>

</head>
<body>

<!--Warning Box-->
<div class="modal fade" id="warningModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="txtWarningHeader">Warning!</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="txtWarning">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!--Profile Modal-->
<div class=" modal fade bd-settings-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="booking-history collapse" id="booking-history">
                <table class="table shadow table-light">
                    <thead class="thead-dark">
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Cus-Name</th>
                        <th scope="col">Car-No</th>
                        <th scope="col">Car Make</th>
                        <th scope="col">Car Model</th>
                        <th scope="col">Start Date</th>
                        <th scope="col">End Date</th>
                        <th scope="col">Total</th>
                        <th scope="col">Status</th>
                    </tr>
                    </thead>
                    <tbody id="tblCustomerBookingHistory">
                    <tr>
                        <!--                    <td>BK-001</td>-->
                        <!--                    <td>200113203389</td>-->
                        <!--                    <td>Saman Kumara</td>-->
                        <!--                    <td>KL-1234</td>-->
                        <!--                    <td>BMW</td>-->
                        <!--                    <td>M5 / Auto</td>-->
                        <!--                    <td>2023-02-15</td>-->
                        <!--                    <td>2023-03-16</td>-->
                        <!--                    <td>186000</td>-->
                        <!--                    <td><button class="btn-sm btn-success btnGetJob">Get Job</button></td>-->
                    </tr>
                    </tbody>
                </table>
                <button class="btn btn-outline-warning" data-toggle="collapse" data-target=".collapse" aria-expanded="false" aria-controls="booking-history settings-content">Settings</button>
            </div>
            <div class="settings-content collapse" id="settings-content">
                <div class="container">
                    <button class="btn btn-outline-light" data-toggle="collapse" data-target=".collapse" aria-expanded="false" aria-controls="booking-history settings-content">My History</button>
                    <div class="mt-lg-4 mb-lg-4">
                        <h1 class="text-warning">Settings</h1>
                        <form action="#" method="post" enctype="multipart/form-data">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="cus_name" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="cus_name" name="cus_name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cus_nic" class="form-label">NIC Number</label>
                                        <input type="text" class="form-control" id="cus_nic" name="cus_nic" disabled>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cus_address" class="form-label">Address</label>
                                        <textarea class="form-control" id="cus_address" name="cus_address" rows="3" required></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cus_contact" class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="cus_contact" name="cus_contact" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cus_email" class="form-label">Email address</label>
                                        <input type="email" class="form-control" id="cus_email" name="cus_email" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="set-username" class="form-label">Username</label>
                                        <input type="text" class="form-control" id="set-username" name="set-username" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="set-password" class="form-label">Password</label>
                                        <input type="password" class="form-control" id="set-password" name="set-password" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">NIC Photo</label>
                                        <!--                                    <input class="form-control" type="file" id="nic_photo" name="nic_photo" accept="image/*" required>-->
                                        <!--                                    <small class="form-text text-muted">Please upload a photo of your NIC or Driving License.</small>-->
                                    </div>
                                    <div class="mb-3 profile-nic-image">

                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-warning font-weight-bold" id="btnCusSettingsSave">Save</button>
                            <a class="btn btn-danger" href="index.html">Logout</a>
                        </form>

                    </div>
                </div>
            </div>

        </div>

    </div>
</div>

<!--Booking Modal-->
<div class="modal fade bd-booking-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="booking-content modal-content">
            <div class="container">
                <h1 class="text-warning font-weight-bold mt-3">Booking</h1>
                <div class="row">
                    <div class="col">
                        <div class="mt-lg-4 mb-lg-4">
                            <form action="#" method="post" enctype="multipart/form-data">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="bk_id" class="form-label">Booking ID:</label>
                                            <input type="text" class="form-control" id="bk_id" name="bk_id" disabled required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="bk_cusNic" class="form-label">Customer NIC:</label>
                                            <input type="text" class="form-control" id="bk_cusNic" name="bk_cusNic" disabled required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="mb-3">
                                            <label for="bk_cus" class="form-label">Customer Name:</label>
                                            <input type="text" class="form-control" id="bk_cus" name="bk_cus" disabled required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md">
                                        <div class="mb-3">
                                            <label for="bk_date" class="form-label">Rent Date:</label>
                                            <input type="date" class="form-control" id="bk_date" name="bk_date" required>
                                        </div>
                                    </div>
                                    <div class="col-md">
                                        <div class="mb-3">
                                            <label for="bk_ndate" class="form-label">End Date:</label>
                                            <input type="date" class="form-control" id="bk_ndate" name="bk_ndate" required>
                                        </div>
                                    </div>
                                </div>

                                <div class="row car-details">
                                    <div class="col-md">
                                        <div class="mb-3">
                                            <label for="bk_carreg" class="form-label">Car Registration:</label>
                                            <input class="form-control" id="bk_carreg" name="bk_carreg" disabled required></input>
                                        </div>
                                    </div>
                                    <div class="col-md">
                                        <div class="mb-3">
                                            <label for="bk_carmake" class="form-label">Brand:</label>
                                            <input class="form-control" id="bk_carmake" name="bk_carmake" disabled required></input>
                                        </div>
                                    </div>
                                </div>


                                <div class="row">
                                    <div class="col-md">
                                        <div class="form-check mb-5">
                                            <input class="form-check-input" type="checkbox" name="bk_withdriver" value="withdriver" id="bk_withdriver">
                                            <label class="form-check-label" for="bk_withdriver">
                                                With Driver
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-warning font-weight-bold" id="btnBookingSubmit">Submit</button>
                            </form>
                        </div>


                    </div>
                    <div class="col">
                        <div class="booking-car-img mb-3">

                        </div>
                        <div class="row">
                            <div class="col-md">
                                <div class="mb-3">
                                    <label for="bk_carmodel" class="form-label">Model:</label>
                                    <input class="form-control" id="bk_carmodel" name="bk_carmodel" disabled required></input>
                                </div>
                             </div>
                        </div>
                       <div class="row d-flex justify-content-end">
                           <div class="col-md-5">
                               <div>
                                   <label for="bk_total" class="form-label">Total Rental/Rs:</label>
                                   <input type="text" class="form-control bg-dark text-light border-danger font-weight-bold" id="bk_total" name="bk_total" required placeholder="0.00">
                                   <small>Without Extra KM</small>
                               </div>
                           </div>
                       </div>
                    </div>
                </div>



            </div>


        </div>
    </div>
</div>

<!--HomePage-->
<div id="homePageContext">

    <!--navBar-->
    <nav class="navbar navbar-expand-lg navbar-light bg-warning">
        <div class="container">
            <a class="navbar-brand" href="#"><img src="assets/images/LogoBlack.png" width="200" alt=""></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#" onclick="getCarsForCards()">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Contact Us</a>
                    </li>
                    <li class="nav-item dropdown profile-link">
                        <button type="button" class="btn btn-dark" id="btnProfile" data-toggle="modal" data-target=".bd-settings-modal-lg">:UserName:</button>
                    </li>
                </ul>
                <span class="navbar-text">
                    <i class="fa-solid fa-phone-volume"></i>
                    011-2332331<br>
                    <i class="fa-solid fa-envelope"></i>
                    contact@easycar.lk
                </span>
            </div>
        </div>
    </nav>

    <!--Welcome Screen-->
    <div id="welcomeScreen" >
        <div class="jumbotron">
            <div class="container">
                <div class="row">
                    <div class="col-md-8">
                        <h1 class="display-4">Rent Your Dream Car Today</h1>
                        <p class="lead">
                            We offer a hassle free car rental service. Book your car online.
                        </p>
                        <hr class="my-4" />
                        <p>Choose from our wide range of cars and start your journey today.</p>
                        <a class="btn btn-outline-warning btn-lg" href="#cardCars" role="button">Book Now</a>
                    </div>
    <!--Login Form-->
                    <div class="col-md-4 login-box">
                        <div class="login-form p-lg-4 border border-warning">
                        <form>
                            <h2 class="text-center">Login</h2>
                            <div class="form-group">
                                <label for="email">Username</label>
                                <input type="text" class="form-control" id="username" placeholder="Username">
                            </div>
                            <div class="form-group">
                                <label for="password">Password</label>
                                <input type="password" class="form-control" id="password" placeholder="Password">
                            </div>
                            <button type="button" class="btn btn-warning" id="btnLogin">Login</button>
                            <small>Don't have an account? <a href="register.html" class="text-warning">Register</a></small>
                        </form>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>

    <!--CarList-->
    <div class="container-fluid d-flex justify-content-center" id="cars">
        <div class="mt-4 car-cards" id="cardCars">
            <div class=" mb-4">
                <div class="card">
                    <img src="assets/images/Genaral/alto-m/1.png" class="card-img-top" width="100%">
                    <div class="card-body pt-0 px-0">
                        <div class="d-flex flex-row justify-content-between mb-0 px-3 mt-1">
                            <div class="d-flex flex-column"><span class="text-muted">Price Per Day:<br><small class="text-muted">100KM</small></span></span></div>
                            <h6>Rs2,500</h6>
                        </div>
                        <div class="d-flex flex-row justify-content-between mb-0 px-3">
                            <div class="d-flex flex-column"><span class="text-muted">Price Per Month:<br><small class="text-muted">2400KM</small></span></div>
                            <h6>Rs64,350</h6>
                        </div>
                        <div class="d-flex flex-row justify-content-between mb-0 px-3">
                            <div class="d-flex flex-column"><span class="text-muted">Price Per extra KM:</span></div>
                            <h6>Rs30</h6>
                        </div>
                        <hr class="mt-2 mx-3">
                        <div class="d-flex flex-row justify-content-between px-3">
                            <div class="d-flex flex-column"><span class="text-muted">Brand:</span></div>
                            <div class="d-flex flex-column"><h5 class="mb-0">Suzuki</h5></div>
                        </div>
                        <div class="d-flex flex-row justify-content-between px-3 ">
                            <div class="d-flex flex-column"><span class="text-muted">Model:</span></div>
                            <div class="d-flex flex-column"><h5 class="mb-0">Alto</h5></div>
                        </div>
                        <div class="d-flex flex-row justify-content-between px-3 ">
                            <div class="d-flex flex-column"><span class="text-muted">No of passengers:</span></div>
                            <div class="d-flex flex-column"><h5 class="mb-0">4</h5></div>
                        </div>
                        <div class="d-flex flex-row justify-content-between px-3 ">
                            <div class="d-flex flex-column"><span class="text-muted">Transmission type:</span></div>
                            <div class="d-flex flex-column"><h5 class="mb-0">Auto</h5></div>
                        </div>
                        <div class="d-flex flex-row justify-content-between px-3 ">
                            <div class="d-flex flex-column"><span class="text-muted">Fuel type:</span></div>
                            <div class="d-flex flex-column"><h5 class="mb-0">Petrol</h5></div>
                        </div>
                        <section>
                        <div class="mx-3 mt-3 mb-2">
                            <button type="submit" class="btnRent btn btn-warning btn-block">Rent</button>
                        </div>
                        <small class="d-flex justify-content-center text-muted">KL-1234</small>
                        </section>
                    </div>
                </div>

            </div>

            </div>
                </div>

<!--    Contact Us-->
    <section id="contact" class="py-5 bg-dark">
        <div class="container">
            <h2 class="text-center text-light">Contact Us</h2>
            <hr />
            <div class="row">
                <div class="col-md-6">
                    <form>
                        <div class="form-group">
                            <label for="name" class="text-light">Name</label>
                            <input type="text" class="form-control" id="name" />
                        </div>
                        <div class="form-group">
                            <label for="email" class="text-light">Email</label>
                            <input type="email" class="form-control" id="email" />
                        </div>
                        <div class="form-group">
                            <label for="message" class="text-light">Message</label>
                            <textarea class="form-control" id="message" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-warning">Submit</button>
                    </form>
                </div>
                <div class="col-md-6">
                    <iframe
                            src="https://maps.google.com/maps?q=easy car rental&t=&z=10&ie=UTF8&iwloc=&output=embed"frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                            class="h-100 w-100" style="border:0;" allowfullscreen="" loading="lazy">

                    </iframe>
                </div>
            </div>
        </div>
    </section>
</div>

<!--Driver Dashboard-->
 <div id="driverDashboardContext" class="bg-light">
    <nav class="navbar shadow-sm navbar-expand-lg navbar-light bg-warning">
        <div class="container">
            <a class="navbar-brand" href="#"><img src="assets/images/LogoBlack.png" width="200" alt=""></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav mr-auto">
                </ul>
                <span class="navbar-text">
                    <i class="fa-solid fa-user"></i>
                    <span id="lblDriverName">Driver</span>
                    <br>
                    <i class="fa-solid fa-key"></i>
                    <span id="lblDriverLic">B12345678</span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="mt-md-4 mb-md-4">
            <h1 class="text-warning font-weight-bold">Driver Dashboard</h1>
            <button class="btn btn-outline-dark mb-3" type="button" id="reloadDriverTable">Reload Table</button>
            <table class="table shadow table-light">
                <thead class="thead-dark">
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Cus-NIC</th>
                    <th scope="col">Cus-Name</th>
                    <th scope="col">Car-No</th>
                    <th scope="col">Car Make</th>
                    <th scope="col">Car Model</th>
                    <th scope="col">Start Date</th>
                    <th scope="col">End Date</th>
                    <th scope="col">Total</th>
                    <th scope="col">Option</th>
                </tr>
                </thead>
                <tbody id="tblDriverSchedule">
                <tr>
<!--                    <td>BK-001</td>-->
<!--                    <td>200113203389</td>-->
<!--                    <td>Saman Kumara</td>-->
<!--                    <td>KL-1234</td>-->
<!--                    <td>BMW</td>-->
<!--                    <td>M5 / Auto</td>-->
<!--                    <td>2023-02-15</td>-->
<!--                    <td>2023-03-16</td>-->
<!--                    <td>186000</td>-->
<!--                    <td><button class="btn-sm btn-success btnGetJob">Get Job</button></td>-->
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!--Footer-->
<footer class="bg-warning py-3">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <p>&copy; 2023 Car Rental Service@TharuZika</p>
            </div>
            <div class="col-md-6">
                <ul class="list-inline float-md-right">
                    <li class="list-inline-item">
                        <a href="#" class="text-dark">Terms of Use</a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#" class="text-dark">Privacy Policy</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<script src="assets/js/jquery-3.6.1.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>

<script>
    let baseURL = "http://localhost:8080/BackEnd_war/"
    let originUserId = null;

    getCarsForCards();
    rentModalOpen();

    var tempCarRentDay;
    var tempCarRentMonth;


    function rentModalOpen(){
        $(".btnRent").click(function (){
            $(".booking-car-img").empty();

            generateId();

            let car_regno = $(this).closest('section').find('small:first').text();
            var imagePath = $(this).closest('.card').find('.card-img-top').attr('src');

            let img = "<img src='"+imagePath+"' width='100%' />"
            $(".booking-car-img").append(img);


            $.ajax({
                url: baseURL+"car/getcar?cr_reg="+car_regno,
                method: "get",
                dataType:"json",
                success:function (res){
                    $("#bk_carreg").val(car_regno);
                    $("#bk_carmake").val(res.data.cr_make);
                    $("#bk_carmodel").val(res.data.cr_model);
                    $("#bk_carmake").val(res.data.cr_make);
                    tempCarRentDay = res.data.cr_day;
                    tempCarRentMonth = res.data.cr_month;
                }
            })

            $('.bd-booking-modal-lg').modal();
        });
    }



    $("#btnLogin").click(function (){

        $(".profile-nic-image").empty();

        var loginObj = {
            userName: $("#username").val(),
            password: $("#password").val(),
            role: null,
            userId: null
        }

        $.ajax({
            url: baseURL + "login/user?userName="+$("#username").val()+"&password="+$("#password").val(),
            method: "get",
            // data: JSON.stringify(loginObj),
            // contentType: "application/json",
            dataType: "json",
            success: function (res) {
                if (res.data.role == "Customer"){
                    $.ajax({
                        url: baseURL + "login/customer?userId=" + res.data.userId,
                        method: "get",
                        success: function (res) {
                            originUserId = res.data.userId;

                            $("#warningModal").modal();
                            $("#txtWarningHeader").text("Success");
                            $("#txtWarning").text(res.message+"! Welcome "+res.data.cus_name);

                            console.log("Success : " + res.data.cus_name);

                            $("#btnProfile").css('display', 'block');
                            $(".btnRent").css('display', 'block');
                            $("#btnProfile").text(res.data.cus_name);

                            $("#cus_nic").val(res.data.cus_nic);
                            $("#cus_name").val(res.data.cus_name);
                            $("#cus_address").val(res.data.cus_address);
                            $("#cus_contact").val(res.data.cus_contact);
                            $("#cus_email").val(res.data.cus_email);

                            $("#bk_cusNic").val(res.data.cus_nic);
                            $("#bk_cus").val(res.data.cus_name);

                            $("#set-username").val(loginObj.userName);
                            $("#set-password").val(loginObj.password);



                            $(".login-box").css('display', 'none');
                        },
                        error: function (err){
                            let message = JSON.parse(err.responseText).message;
                            $("#warningModal").modal();
                            $("#txtWarningHeader").text("Error");
                            $("#txtWarning").text(message);

                            console.log("Error : " + message)
                        }
                    });
                    $.ajax({
                        url: baseURL + "image/findimage?imageId="+res.data.userId,
                        method: 'get',
                        dataType: 'json',
                        success: function (res){
                            let card ="<img src="+baseURL+res.data.imageUrl+" width='100%'>";
                            $(".profile-nic-image").append(card);


                        },
                        error: function (err){
                            console.log("Can't Load Image : "+JSON.parse(err.responseText).message);
                        }
                    });



                }if (res.data.role == "Driver"){

                    getAllBookingsDriver();

                    $.ajax({
                       url: baseURL+"login/driverinfo?userId="+res.data.userId,
                        method: "get",
                        success: function (res) {
                           $("#lblDriverName").text(res.data.dr_name);
                           $("#lblDriverLic").text(res.data.dr_lic);
                        }
                    });

                    $("#driverDashboardContext").css('display' , 'block');
                    $("#homePageContext").css('display' , 'none');

                }if (res.data.role == "Admin"){
                    $.ajax({
                        url: baseURL + "login/admin?userId=" + res.data.userId,
                        method: "get",
                        success: function (res) {

                            console.log("Success : " + res.data.adminName);

                            $("#warningModal").modal();
                            $("#txtWarningHeader").text("Success");
                            $("#txtWarning").text("Welcome "+res.data.adminName);

                            $(location).attr('href', 'adminDashboard.html');
                        },
                        error: function (err){
                            let message = JSON.parse(err.responseText).message;
                            $("#warningModal").modal();
                            $("#txtWarningHeader").text("Error");
                            $("#txtWarning").text(message);

                            console.log("Error : " + message)
                        }
                    });
                }

            },
            error: function (err) {
                let message = JSON.parse(err.responseText).message;
                $("#warningModal").modal();
                $("#txtWarningHeader").text("Error");
                $("#txtWarning").text(message);

                console.log("Error : " + message)
            }
        });

    });

    function getCarsForCards(){
        $("#cardCars").empty();
        $.ajax({
            url: baseURL + "car/allcar",
            method: 'get',
            dataType: 'json',
            success: function (res) {
                for (let c of res.data) {
                    let carReg = c.cr_reg;
                    let carMake = c.cr_make;
                    let carModel = c.cr_model;
                    let carType = c.cr_type;
                    let carFuel = c.cr_fuel;
                    let carNfp = c.cr_nfp;
                    let carDay = c.cr_day;
                    let carMonth = c.cr_month;
                    let carKm = c.cr_km;
                    let carAvail = c.cr_avail;

                    if (carAvail == "Yes"){
                        $.ajax({
                            url: baseURL + "image/findimage?imageId="+c.cr_reg,
                            method: 'get',
                            dataType: 'json',
                            success: function (res){
                                let card ="<div class='mb-4'><div class='card'><img src="+baseURL+res.data.imageUrl+" class='card-img-top' width='100%'><div class='card-body pt-0 px-0'><div class='d-flex flex-row justify-content-between mb-0 px-3 mt-1'><div class='d-flex flex-column'><span class='text-muted'>Price Per Day:<br><small class='text-muted'>100KM</small></span></span></div><h6>RS:"+carDay+"/=</h6></div><div class='d-flex flex-row justify-content-between mb-0 px-3'><div class='d-flex flex-column'><span class='text-muted'>Price Per Month:<br><small class='text-muted'>2400KM</small></span></div><h6>RS:"+carMonth+"/=</h6></div><div class='d-flex flex-row justify-content-between mb-0 px-3'><div class='d-flex flex-column'><span class='text-muted'>Price Per extra KM:</span></div><h6>RS:"+carKm+"/=</h6></div><hr class=mt-2 mx-3'><div class='d-flex flex-row justify-content-between px-3'><div class='d-flex flex-column'><span class='text-muted'>Brand:</span></div><div class='d-flex flex-column'><h5 class='mb-0'>"+ carMake +"</h5></div></div><div class='d-flex flex-row justify-content-between px-3'><div class='d-flex flex-column'><span class='text-muted'>Model:</span></div><div class='d-flex flex-column'><h5 class='mb-0'>"+carModel+"</h5></div></div><div class='d-flex flex-row justify-content-between px-3'><div class='d-flex flex-column'><span class='text-muted'>No of passengers:</span></div><div class='d-flex flex-column'><h5 class='mb-0'>"+carNfp+"</h5></div></div><div class='d-flex flex-row justify-content-between px-3'><div class='d-flex flex-column'><span class='text-muted'>Fuel type:</span></div><div class='d-flex flex-column'><h5 class='mb-0'>"+carFuel+"</h5></div></div><section><div class='mx-3 mt-3 mb-2'><button type='button' class='btnRent btn btn-warning btn-block'>Rent</button></div><small class='d-flex justify-content-center text-muted'>"+carReg+"</small></section></div></div></div>";
                                $("#cardCars").append(card);
                                rentModalOpen();
                            },
                            error: function (err){
                                console.log("Can't Load Image : "+JSON.parse(err.responseText).message);
                            }
                        });
                    }
                }

            },
            error: function (error) {
                let message = JSON.parse(error.responseText).message;
                alert(message);
            }
        });
    }

    $("#btnBookingSubmit").click(function (){
        var startDate = new Date($('#bk_date').val());
        var endDate = new Date($('#bk_ndate').val());
        var days = Math.floor((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));
        var totalRent = 0;
        if (days<20){
            totalRent = tempCarRentDay*days;
        }else if(days>20){
            totalRent = tempCarRentMonth*days/20;
        }
        console.log(totalRent);
        console.log('Total Days: ' + days);

        var withdriver = "Without Driver";
        var driverdetails = "No Driver"

        if ($("input[name='bk_withdriver']:checked").val() == "withdriver"){
            withdriver = "With Driver";
            driverdetails = "Pending";
        }

        var bookingInfoObj = {
            bk_id: $("#bk_id").val(),
            bk_cusnic: $("#bk_cusNic").val(),
            bk_cusname: $("#bk_cus").val(),
            bk_carreg: $("#bk_carreg").val(),
            bk_carmake: $("#bk_carmake").val(),
            bk_model: $("#bk_carmodel").val(),
            bk_withdriver: withdriver,
            bk_drlic: driverdetails,
            bk_drname: driverdetails,
            bk_date: $("#bk_date").val(),
            bk_ndate: $("#bk_ndate").val(),
            bk_total: $("#bk_total").val(),
            bk_adminstatus: "Pending"
        }

        $.ajax({
            url: baseURL+"booking/save",
            method: 'post',
            data: JSON.stringify(bookingInfoObj),
            contentType: "application/json",
            dataType: "json",
            success: function (res) {
                 $("#warningModal").modal();
                 $("#txtWarningHeader").text("Success");
                 $("#txtWarning").text(res.message);
            },
            error: function (err) {
                    let message = JSON.parse(err.responseText).message;
                    $("#warningModal").modal();
                    $("#txtWarningHeader").text("Error");
                    $("#txtWarning").text(message);
                }
            });

        console.log(bookingInfoObj);
    });

    function generateId(){

        $.ajax({
            url: baseURL+"booking/generateid",
            method: 'get',
            dataType: 'json',
            success: function (res){
                $("#bk_id").val(res.data);
            },
            error: function (err){
                let message = JSON.parse(error.responseText).message;
                console.log("Cant Generate ID : "+message);
            }
        })


    }

    $(document).keypress(function (e){
        if (e.which == 13){
            var startDate = new Date($('#bk_date').val());
            var endDate = new Date($('#bk_ndate').val());
            var days = Math.floor((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));
            var totalRent = 0;
            if (days<20){
                totalRent = tempCarRentDay*days;
            }else if(days>20){
                totalRent = tempCarRentMonth*days/20;
            }
            console.log(totalRent);
            if ($("input[name='bk_withdriver']:checked").val() == "withdriver"){
                totalRent=totalRent+days*1000;
            }
            $("#bk_total").val(totalRent);
        }
    });

    $("#bk_withdriver").click(function (){
        var startDate = new Date($('#bk_date').val());
        var endDate = new Date($('#bk_ndate').val());
        var days = Math.floor((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));
        var totalRent = 0;
        if (days<20){
            totalRent = tempCarRentDay*days;
        }else if(days>20){
            totalRent = tempCarRentMonth*days/20;
        }
        console.log(totalRent);
        if ($("input[name='bk_withdriver']:checked").val() == "withdriver"){
            totalRent=totalRent+days*1000;
        }
        $("#bk_total").val(totalRent);

    });

    $("#btnCusSettingsSave").click(function (){
        let cusDataObj = {
            cus_nic: $("#cus_nic").val(),
            cus_name: $("#cus_name").val(),
            cus_address: $("#cus_address").val(),
            cus_contact: $("#cus_contact").val(),
            cus_email: $("#cus_email").val()
        };

        let cusLoginDataObj = {
            userId: originUserId,
            userName: $("#set-username").val,
            password: $("#set-password").val,
            role: "Customer"

        }

        $.ajax({
            url: baseURL + "customer/update",
            method: "PUT",
            data: JSON.stringify(cusDataObj),
            contentType: "application/json",
            dataType: "json",
            success: function (res) {

                // Customer Username Password Update
                // $.ajax({
                //     url: baseURL + "register/updatecus",
                //     method: "PUT",
                //     data: JSON.stringify(cusLoginDataObj),
                //     contentType: "application/json",
                //     dataType: "json",
                //     error: function (err) {
                //         let message = JSON.parse(err.responseText).message;
                //         $("#warningModal").modal();
                //         $("#txtWarningHeader").text("Error");
                //         $("#txtWarning").text(message);
                //
                //         console.log("Error : " + message)
                //     }
                // });

                $("#btnProfile").css('display', 'block');
                $("#btnProfile").text(cusDataObj.cus_name);

                $("#cus_nic").val(cusDataObj.cus_nic);
                $("#cus_name").val(cusDataObj.cus_name);
                $("#cus_address").val(cusDataObj.cus_address);
                $("#cus_contact").val(cusDataObj.cus_contact);
                $("#cus_email").val(cusDataObj.cus_email);

                let message = res.message;
                $("#warningModal").modal();
                $("#txtWarningHeader").text("Success");
                $("#txtWarning").text(res.message);

                $(".bd-settings-modal-lg").modal('hide');

                console.log("Success : " + message);
            },
            error: function (err) {
                let message = JSON.parse(err.responseText).message;
                $("#warningModal").modal();
                $("#txtWarningHeader").text("Error");
                $("#txtWarning").text(message);

                console.log("Error : " + message)
            }
        });
    });


    //Driver Configure
    function getAllBookingsDriver() {
        $("#tblDriverSchedule").empty();
        $.ajax({
            url: baseURL + "booking/getall",
            method: 'get',
            dataType: 'json',
            success: function (res) {
                for (let c of res.data) {
                    let bkId = c.bk_id;
                    let bkCusnic = c.bk_cusnic;
                    let bkCusname = c.bk_cusname;
                    let bkCarreg = c.bk_carreg;
                    let bkCarmake = c.bk_carmake;
                    let bkModel = c.bk_model;
                    let bkWithdriver = c.bk_withdriver;
                    let bkDrlic = c.bk_drlic;
                    let bkDrname = c.bk_drname;
                    let bkDate = c.bk_date;
                    let bkNdate = c.bk_ndate;
                    let bkTotal = c.bk_total;
                    let bkAdminstatus = c.bk_adminstatus;
                    if (bkAdminstatus == "Approved" && bkWithdriver=="With Driver" && bkDrname=="Pending"){
                        let row = "<tr><td>" + bkId + "</td><td>" + bkCusnic + "</td><td>" + bkCusname + "</td><td>" + bkCarreg + "</td><td>" + bkCarmake + "</td><td>" + bkModel + "</td><td>" + bkDate + "</td><td>" + bkNdate + "</td><td>" + bkTotal + "</td><td><button class='btn-sm btn-success btnApproveDriver'>Get Job</button></td></tr>";
                        $("#tblDriverSchedule").append(row);
                    }

                }

            },
            error: function (error) {
                let message = JSON.parse(error.responseText).message;
                alert(message);
            }
        });
    }

    $(document).on('click', '.btnApproveDriver', function () {
        let bk_id = $(this).closest('tr').find('td:first').text();
        console.log(bk_id)
        $.ajax({
            url: baseURL + "booking/findbooking?bk_id="+bk_id,
            method: "get",
            success: function (resp) {

                aprovedBookingDriverObj = {
                    bk_id: resp.data.bk_id,
                    bk_cusnic: resp.data.bk_cusnic,
                    bk_cusname: resp.data.bk_cusname,
                    bk_carreg: resp.data.bk_carreg,
                    bk_carmake: resp.data.bk_carmake,
                    bk_model: resp.data.bk_model,
                    bk_withdriver: resp.data.bk_withdriver,
                    bk_drlic: $("#lblDriverLic").text(),
                    bk_drname: $("#lblDriverName").text(),
                    bk_date: resp.data.bk_date,
                    bk_ndate: resp.data.bk_ndate,
                    bk_total: resp.data.bk_total,
                    bk_adminstatus: resp.data.bk_adminstatus
                }



                $.ajax({
                    url: baseURL + "booking/update",
                    method: "PUT",
                    data: JSON.stringify(aprovedBookingDriverObj),
                    contentType: "application/json",
                    dataType: "json",
                    success: function (resp) {
                        getAllBookingsDriver();

                        console.log(resp.message);
                        $("#warningModal").modal();
                        $("#txtWarningHeader").text("Success");
                        $("#txtWarning").text(resp.message);

                    }
                });

            },
            error: function (error) {
                let message = JSON.parse(error.responseText).message;
                $("#warningModal").modal();
                $("#txtWarningHeader").text("Error");
                $("#txtWarning").text(message);
            }
        });
    });

    $("#reloadDriverTable").click(function (){
       getAllBookingsDriver();
    });

    $("#btnProfile").click(function (){
        $("#booking-history").collapse({
            toggle: true
        });
    });



</script>
</body>
</html>