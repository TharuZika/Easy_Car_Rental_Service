<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Easy Car Rental Service</title>
  <link rel="stylesheet" href="assets/css/bootstrap.css">
  <script src="https://kit.fontawesome.com/97dbc65e21.js" crossorigin="anonymous"></script>

  <style>
    body{
      background-image: url("assets/images/bg.jpg");
      background-size: cover;
      color: white;
    }

    .content{
      height: 75vh;
    }



  </style>

</head>
<body>
<!--navBar-->
<nav class="navbar navbar-expand-lg navbar-light bg-warning">
  <div class="container">
    <a class="navbar-brand" href="#"><img src="assets/images/LogoBlack.png" width="200" alt=""></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="index.html?#contact">Contact Us</a>
        </li>
      </ul>
      <span class="navbar-text">
                <i class="fa-solid fa-phone-volume"></i>
                011-2332331<br>
                <i class="fa-solid fa-envelope"></i>
                contact@easycar.lk
            </span>
    </div>
  </div>
</nav>

<!--Warning Modal-->
<div class="modal fade" id="warningModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-dark" id="txtWarningHeader">Warning!</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-dark" id="txtWarning">

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--RegisterForm-->

<div class="container content">
  <div class="mt-lg-4 mb-lg-4 reg-content">
  <h1 class="text-warning">Registration Form</h1>
    <form id="formCustomer">
      <div class="row">
        <div class="form-group col-4">
          <label for="cus_nic">NIC Number:</label>
          <input type="text" class="form-control" id="cus_nic" name="cus_nic" required>
        </div>
        <div class="form-group col-8">
          <label for="cus_name">Name:</label>
          <input type="text" class="form-control" id="cus_name" name="cus_name" required>
        </div>
      </div>

      <div class="form-group">
        <label for="cus_address">Address:</label>
        <input type="text" class="form-control" id="cus_address" name="cus_address" required>
      </div>
      <div class="row">
        <div class="col form-group">
          <label for="cus_contact">Contact Number:</label>
          <input type="text" class="form-control" id="cus_contact" name="cus_contact" required>
        </div>
        <div class="col form-group">
          <label for="cus_email">Email:</label>
          <input type="email" class="form-control" id="cus_email" name="cus_email" required>
        </div></div>

      <div class=" form-group">
        <label for="cus_img">NIC Image:</label>
        <input type="file" class="form-control-file" id="cus_img" accept="image/*" required>
      </div>
      <button type="button" class="btn btn-success font-weight-bold" id="btnSaveCus" data-toggle="modal" data-target=".bd-example-modal-sm">Save</button>
    </form>
  </div>
</div>

<!--Modal For Login Details-->
<div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content bg-dark rounded-lg">
      <div class="login-form p-lg-4 border border-warning rounded-lg">
        <form id="formCusLogin">
          <p class="text-center text-warning"><Strong>Saved!</Strong><br>Now Enter Login Details</p>
          <h2 class="text-center">SignUp</h2>
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" class="form-control" id="username" name="username" aria-describedby="emailHelp" placeholder="Username">
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" class="form-control" id="password" placeholder="Password">
          </div>
          <div class="form-group">
            <label for="conPassword">Confirm Password</label>
            <input type="password" class="form-control" id="conPassword" name="password" placeholder="Confirm Password">
          </div>
          <button type="button" class="btn btn-warning font-weight-bold" id="btnSaveCusWithLogin">Save</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!--Footer-->
<footer class="bg-warning py-3">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <p class="text-dark">&copy; 2023 Car Rental Service</p>
      </div>
      <div class="col-md-6">
        <ul class="list-inline float-md-right">
          <li class="list-inline-item">
            <a href="#" class="text-dark">Terms of Use</a>
          </li>
          <li class="list-inline-item">
            <a href="#" class="text-dark">Privacy Policy</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<script src="assets/js/jquery-3.6.1.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script>
  let baseURL = "http://localhost:8080/BackEnd_war/"

  function validationCustomer(){
    if (!/^(\d{9}[vV]|\d{12})$/.test($("#cus_nic").val())) {
      $(".bd-example-modal-sm").modal('hide');
      $("#warningModal").modal();
      $("#txtWarningHeader").text("Warning!");
      $("#txtWarning").text("Please enter a valid NIC number.");
      return false;
    }

    if (!/^[a-zA-Z\s]{3,}$/.test($("#cus_name").val())) {
      $(".bd-example-modal-sm").modal('hide');
      $("#warningModal").modal();
      $("#txtWarningHeader").text("Warning!");
      $("#txtWarning").text("Please enter a valid name.");
      return false;
    }

    if (!/^[a-zA-Z\s]{3,}$/.test($("#cus_address").val())) {
      $(".bd-example-modal-sm").modal('hide');
      $("#warningModal").modal();
      $("#txtWarningHeader").text("Warning!");
      $("#txtWarning").text("Please enter a valid address.");
      return false;
    }

    if (!/^[0-9]{10}$/.test($("#cus_contact").val())) {
      $(".bd-example-modal-sm").modal('hide');
      $("#warningModal").modal();
      $("#txtWarningHeader").text("Warning!");
      $("#txtWarning").text("Please enter a valid contact number.");
      return false;
    }

    if (!/^\S+@\S+\.\S+$/.test($("#cus_email").val())) {
      $(".bd-example-modal-sm").modal('hide');
      $("#warningModal").modal();
      $("#txtWarningHeader").text("Warning!");
      $("#txtWarning").text("Please enter a valid email.");
      return false;
    }
    return true;
  }


  $("#btnSaveCusWithLogin").click(function (){

    if (validationCustomer()){
      let formCusData = $("#formCustomer").serialize();

      $.ajax({
        url: baseURL + "customer/save",
        method: "post",
        data: formCusData,
        dataType: "json",
        success: function (res) {

          let cusImgFormData = new FormData();

          let file1 = $("#cus_img")[0].files[0];
          let fileName1 = $("#cus_img")[0].files[0].name;

          cusImgFormData.append("imageId", $("#cus_nic").val());
          cusImgFormData.append("imageType", "nic");
          cusImgFormData.append("imageFile" ,file1, fileName1);

          $.ajax({
            url: baseURL + "image/save",
            method: "post",
            data: cusImgFormData,
            dataType: "json",
            async: true,
            contentType: false,
            processData: false,
            enctype: "multipart/form-data",
            success: function (res) {
              console.log(res.message);
            },
            error: function (err){
              console.log("Can't Save Image : "+JSON.parse(err.responseText).message);
            }
          });

          alert(res.message);

          console.log("Successfully Registered! Now Login Again");
          setCusTxtField("", "", "", "", "");
        },
        error: function (err) {
          let message = JSON.parse(err.responseText).message;
          alert(message);
          console.log("Error : " + message)
        }
      });

      var cusLogObj = {
        userId: $("#cus_nic").val(),
        userName : $("#username").val(),
        password : $("#password").val(),
        role  : "Customer"
      }

      $.ajax({
        url: baseURL + "register/customer",
        method: "post",
        data: JSON.stringify(cusLogObj),
        contentType: "application/json",
        dataType: "json",
        success: function (res) {
          $(location).attr('href', 'index.html');
        },
        error: function (err) {
          let message = JSON.parse(err.responseText).message;
          alert(message);
          console.log("Error : " + message)
        }
      });
    }

  });

  function setCusTxtField(cus_nic, cus_name, cus_address, cus_contact, cus_email){
    $("#cus_nic").val(cus_nic);
    $("#cus_name").val(cus_name);
    $("#cus_address").val(cus_address);
    $("#cus_contact").val(cus_contact);
    $("#cus_email").val(cus_email);
  }

</script>
</body>
</html>